# オンラインリソースによる考古遺跡地図作成実習  

#### *考古学・文化財のためのデータサイエンス・サロンonline #01*  

2020年9月5日　14:00～17:00  

### 事前準備
* 本実習はZoomを使用します。予めZoomアプリをインストールしてください  
    * 旧バージョンのZoomはセキュリティの関係などで正常に作動しない場合があります。必ず最新バージョンにアップデートしてください  
    * 参加用のリンクURLはPeatixを通じてご案内しています  

* Zoomミーティングへの参加
1. 「待機室」が有効になっています。お名前を確認した上で参加を承認します  
    * Zoomの表示名を必ずPeatixでお申込みいただいた時のお名前にしてください  
　　　参考：https://blog.coubic.com/onlinelesson/zoom-name-change/

2. ビデオのオンオフ(顔出し)は任意です。マイクは基本オフ(ミュート)で開始してください  

3. 進行中の確認当はZoomのリアクション(非言語的フィードバック)を使用します  
    * 実習の作業が完了した場合は緑色のチェック✅をクリックしてください  
    * 質問等がある場合は挙手✋をクリックしてください  
    * 質問内容はチャットに書き込んでください  
    * 参考：[ミーティング中の非言語的フィードバック](https://zoom-support.nissho-ele.co.jp/hc/ja/articles/360025314131-%E3%83%9F%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E4%B8%AD%E3%81%AE%E9%9D%9E%E8%A8%80%E8%AA%9E%E7%9A%84%E3%83%95%E3%82%A3%E3%83%BC%E3%83%89%E3%83%90%E3%83%83%E3%82%AF)

4. オンラインワークショップでは、互いに面識のない方が多数参加します。お互いを尊重し、ハラスメント行為などは決して行わないようにしてください  
    * 直接の知り合いでない場合、個別の連絡(チャット等)を一方的に行なったり返信を要求すること、連絡先を求めることは行なわないでください  
    * スクリーンショットに写り込んだ他の参加者の肖像権・プライバシーを尊重してください（講師についてはその限りではありません）  

***

### ~Googleドライブ~ GitHubリポジトリ  
1. 実習で使用するデータ等は~Googleドライブ上の共有フォルダにあります~ **[GitHubリポジトリ](https://github.com/kotdijian/JASOSR/tree/master/MappingWokrshop)に移動しました**   

2. ~共有フォルダは上記リンクを知っている全員がアクセスし編集できる設定となっています。リンクは参加者のみにお知らせしています。ご留意ください~ **リポジトリは公開設定です**

3. ~ワークショップ時のデータ操作は、必ず各自のドライブにコピーまたはPCにダウンロードして行なってください~
    リポジトリの内容は緑色の【↓Code】をクリックし、【Download .zip】を選択するとダウンロードできます  

4. ~共有フォルダ上のファイルを直接編集したり、移動したり、削除しないでください~
    * ~自分のドライブに移動する際は、必ずコピーを作成した上で、行なってください~  

5. ~注意：上記共有フォルダは主催者（野口）の個人用Googleドライブ上にあります。個人的なデータ、ドキュメント類の追加は行なわないでください~  
    * ~個人で編集・使用するデータ、ドキュメントは、必ず自分自身のドライブに作成・複製してください~

#### リポジトリ上のデータについて
* [スライドはこちら](https://kotdijian.github.io/JASOSR/MappingWokrshop/)
* 東京都遺跡地図編集.xlsx：実習1～2で使用します *Googleスプレッドシートをダウンロードしました*  
* 都遺跡地図時代別分布図作成用データ.xlsx：実習3で使用します *Googleスプレッドシートをダウンロードしました*  
    * 東京都遺跡地図収録データのうち位置座標不明のものを除く、時代データリスト付き  
* 抄録データ編集用.xlsx：実習 で使用します *Googleスプレッドシートをダウンロードしました*  
* 13TokyoSJS.zip：ひなたGIS読み込み用のShift-JIS形式の.csvファイルのセット  
    * 13Tokyo_totalcoordSJS.csv：東京都遺跡地図の全データから位置座標を与えられない2件を除いたもの  
    * 13Tokyo_totalAgeSJS.csv：遺跡ごとに旧石器時代～近世の有無をデータ化したもの（_totalcoordと同じく位置座標なしデータを除外済み）  
    * 13Tokyo_palaeolithicSJS.csv～_earlymodernSJS.csv：_totalcoordのデータを時代別に切り出したもの（各時代ごとに重複あり）  
    * 共有ドライブで提供するデータは、GitHubリポジトリで提供しています。利用の際の出所表記は同リポジトリとしてください  

***
### 実習1：東京都遺跡地図データの取得
1. 東京都遺跡地図情報インターネット提供サービスを開きます  
2. 利用条件に同意して地図画面に移ります  
3. 遺跡名、所在地（区市町村）、時代などを選択します  
4. 地図画面したリストor地図画面上の表示から遺跡を選択します  
5. 詳細をクリックして情報を表示します  
6. 表示された情報をコピーします  
7. コピーした情報をGoogleスプレッドシートやMicrosoft Excelなどに貼りつけます  
8. データの配列が縦方向（見出し・項目が列、属性情報が行に配置されている）なので、横方向（見出しが先頭行・項目が各行、属性情報が列）に変換します  
    * Microsoft Excelの場合: 「ホーム」→「貼り付け」→「行／列の入れ替え」  
9. 範囲を選択→右クリック→「特殊貼り付け」→「転置して貼り付けする」  
10. 2件目以降は項目部分（コピーしたデータの右列）のみを選択して「転置して貼り付けする」  

***
### 実習2：ひなたGISによる位置座標の取得
1. 実習1で作成したデータの住所情報の列名（都遺跡地図なら「所在地」）を「変換元住所」に変更します  
2. シートをカンマ区切り形式(.csv)でローカルに保存します（ファイル→ダウンロード→カンマ区切りの値）  
3. 保存したファイルをメモ帳などテキストエディタで開きます  
4. 文字コードをShift-JIS（メモ帳ならANSI）に指定して保存します  
    * Windows版Excelの場合、デフォルトでShift-JISでの保存になります  
    * Mac版Excelの場合、CSV UTF-8とＣＳＶの2つの選択肢があります。後者はShift-JISです  
5. [ひなたGIS](https://hgis.pref.miyazaki.lg.jp/hinata/)を開きます  
6. 地図画面に保存した.csvファイルをドロップします  
7. 元データ（ここでは東京都遺跡地図）を参照して正しい位置にプロットします  
    * 位置を修正したい点を右クリック→左クリックでドラッグして移動  
8. 任意の場所を右クリック→表示されるメニューの「ファイル」→「csvを保存」  
* **重要** UTF-8↔Shift-JISの変換の際に、システム環境に依存する記号(ローマ数字・№等）、JIS第2水準漢字等が文字化けする場合があります。取得した座標データのみを取り出し元のシートに追加でペーストする方が間違いが少ないです  
9. 位置情報のないデータの作成等: 
    * ひなたGISの画面上で任意の場所を右クリック→「選択してください」→「点」→位置座標を取得したい位置をクリックします  
    * 遺跡番号、遺跡名等の属性情報を追加する場合は赤色の「属性」ボタンをクリックして、必要項目を入力します
    * 点データは実習2と同じ方法で.csvに書き出し可能です
    * 線、面（多角形）を描画することも可能。ただし線や面はGeoJSON形式で書き出し保存することになります
　　* 参考：[GeoJSON](https://ja.wikipedia.org/wiki/GeoJSON) 
10. 作成した点、線、面データは、背景地図の設定と合わせてサーバーに保存しURLとして共有することも可能です。任意の点等を右クリック→ファイル→サーバー保存を選択、保存完了のメッセージが出たらURLをコピー取得します

***
### 実習3：時代別分布図の作成

1. 実習2で作成したものと同等の位置座標を含むデータセット(時代別分布図作成用データ)をスプレッドシート(またはExcel)で開き、【時代】の列を選択します  
2. フィルターボタンをクリック→1行目の列名の横に表示される▼をクリック（フィルターを起動）します 
3. 「条件でフィルター」→「次を含むテキスト」を選択→「値または数式」に時代を入力します　
    * Microsoft Excelの場合:「ホーム」→「並べ替えとフィルター」→「フィルター」→列名【時代】の横に表示される▼をクリック（フィルターを起動）→「テキストフィルター」→「指定の値を含む」→「オートフィルター オプション」の「抽出条件の指定：時代」に次代を入力します  
4. 東京都遺跡地図の時代区分は、旧石器、縄文、弥生、古墳、奈良、平安、中世、近世と不明の9項目
5. フィルターされた一覧表の全体をコピー→新しいシートに貼り付けます
6. 新しいシートを.csvで書き出し保存→Shift-JISに変換(必要により)→ひなたGISに読み込みします。手順は実習2-1～5と同じです

* 種別、主な遺構、主な出土品でフィルターをかけることで異なる分布図を作成できます  
* フィルターを重ねることも可能　例) 縄文時代の貝塚、中世の出土品に「銭」を含む遺跡etc.  
* 複数のデータを色分けして表示することも可能です  
    1. 1～5の手順でデータを作成→【緯度】列の右に【色】列を追加します  
    2. データごとに異なる色を割り当て、それぞれを読み込みます  
    * 色名で指定: blue, red, green, yellow, orange...など  
    * rgbで指定: rgb(0,0,255), rgb(255,0,0), rgb(0,255,0)...など  
    
***
### 実習4：背景地図の選択等
1. 実習3で作成した地図をもとに背景に表示する地図を切り替えます
2. ひなたGIS画面右上の赤色の「背景」をクリック→表示したい地図等を選択します
3. 複数の地図を重ね合わせ、前面の地図を透過させることも可能します
4. 地図上の任意の点を右クリック→「効果」から、ヒートマップやバッファーを表示することも可能です

***
### 実習5：地理院地図による分布図の作成
* **基本的にひなたGISと共通です**
1. [地理院地図](https://maps.gsi.go.jp/)を開きます  
2. 右上の「ツール」→「作図・ファイル」をクリックします  
3. 読み込むデータを地図画面にドロップ、または「作図・ファイル」ウインドウの「ファイルからデータを読み込み」(フォルダのアイコン)からファイルを指定して読み込みます  
4. 位置情報を取得する列を自動検出し確認するよう要求されます。また同じダイアログでアイコンの種類(色・シンボル)と拡大率(大きさ)を指定します  
5. 読み込んだデータは「作図・ファイル」ウインドウにレイヤー表示されます。個別に表示のON/OFFも可能です  
6. 左上の「地図」ボタンをクリックすると「地図の種類」ウインドウが開きます。適宜背景地図を選択してください  

* **地理院地図では複数のデータソースを重ねて表示することができます**  
* 地理院地図からはcsv形式の書き出し・保存はできません(GeoJSONのみ)  

***
### 実習6：報告書抄録データの取得
1. 全国遺跡報告総覧の抄録検索（https://sitereports.nabunken.go.jp/ja/search-site）を開きます
2. 検索項目の選択・キーワードの入力→該当する書誌・抄録情報を選択します  
3. 調査地点情報（「所収遺跡」の項）をコピーし、転置して貼り付けします  
4. 遺跡詳細情報（遺跡情報中の「遺跡概要」の項）をコピーし、転置して貼り付けします
5. ひとつの調査地点に複数の遺跡詳細情報(時代別など)がある場合は、調査地点情報をコピーし、右側に新しい遺跡詳細情報を追加します　　
6. **重要** 東京都遺跡地図と異なり位置情報(所在地or緯度経度)と遺跡情報(種別,時代,主な遺構,主な遺物)が分かれて収録されているのでつなげる必要があります  
7. **重要** 主な遺構、主な出土遺物などの項目はセル内に**改行記号**が含まれているため、そのまま.csv書き出しをすると同一の調査地点・詳細情報の途中で改行されてしまいます。予め改行を削除し、カンマ以外の区切り記号に置換しておきます
    * **改行記号をカンマで置換すると項目(列)数が増えてしまい不整なデータとなります  

***
#### 参考：その他の考古学データベース
* [奈良文化財研究所「遺跡データベース」](http://mokuren.nabunken.go.jp/Iseki/index.html)  
* [日本旧石器学会「日本列島の旧石器時代遺跡」](http://palaeolithic.jp/data/index.htm)  
* [国立歴史民俗博物館「縄文・弥生集落データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/jomo/db_param)
* [奈良文化財研究所「木簡庫」](https://mokkanko.nabunken.go.jp/ja/)
* [奈良文化財研究所「古代地方官衙関係遺跡データベース」](http://mokuren.nabunken.go.jp/NCPstr/NCPstr.htm)  
* [奈良文化財研究所「古代寺院遺跡データベース」](http://mokuren.nabunken.go.jp/NCPstjiin/NCPstrJ.htm)
* [国立歴史民俗博物館「東国板碑データベース」](https://www.rekihaku.ac.jp/doc/itabi.html)
* [国立歴史民俗博物館「陶磁器出土遺跡データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/boue/db_param)
* [国立歴史民俗博物館「城館城下発掘データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/joka/db_param)
* [国立歴史民俗博物館「遺跡発掘調査報告書放射性炭素年代測定データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/esrd/db_param) 
* [国立歴史民俗博物館「日本の遺跡出土大型植物遺体データベース」](https://www.rekihaku.ac.jp/up-cgi/login.pl?p=param/issi/db_param)  

***
#### **注意事項1**：文字データのエンコードについて
* コンピュータで使用される文字の表示方式は、長年、メーカーやOSごとに異なるものが使用されてきました。とくに文字数の多い漢字・ハングルなどや各種記号は不一致が多く、ことなるエンコード形式間で互換性がありません
* 近年、ウェブ上のエンコード方式はUTF-8に統一される傾向にありますが、Windowsを中心にその他の形式が使用されている事例も少なくありません
* 漢字やハングルを含む中国語・日本語・韓国語はエンコードの相違による文字化けが発生しやすく、データの不備やプログラムの実行に支障を来たす場合が多くあります（CJK問題と称される）
* 考古学においては学史上第2水準漢字の使用がやむを得ないケースがありますが、カタカナ表記を併記するなどの工夫が必要です。さらにローマ数字やその他の特殊記号は基本的に使用しないことが重要です

***
#### **注意事項2**：座標数値の表記について
* 緯度・経度の表記については小学校の社会科以降、60進法の度分秒（° ′ ″）で習ってきたと思います。一方、コンピュータのシステムはほぼすべて10進法表記です（内部では2進法→16進法ですが...）
* ウェブ上の各種地図サービスやGISでは、60進法と10進法の2つの表記に対応している場合もありますが、データは基本的に10進法で取り扱います。ただし「度」については従来通り、北緯・南緯0～90度、東経・西経0～180度となります
* 10進法による緯度経度座標の表記では、整数部分は「度」です。60進法による度分秒表記と一致します
* 小数部分は、「分」「秒」を変換したものとなっています
    * 例1) 25分は0.4度です（25/60=0.4）
    * 例2) 16秒は0.0044...度です（16/60/60=16/3600=0.0044...）
    * 例3) 25分16秒は0.4044...度です
    **※0.2516または0.25.16とは表記しません**

***
#### 参考：ズームレベル
* GISやウェブ地図サービスでは、紙地図の縮尺に対応する概念としてズームレベルが定義されています
* ズームレベルは各種ソフトやウェブサービスで共通です
    * **参考**：https://www.wingfield.gr.jp/archives/5777
* 対象地域の状況（都市か山岳地帯か）や対象物のサイズにより適切なズームレベルを選択しましょう

***
#### 参考：位置情報の解像度
* 日本付近では緯度経度1秒の実距離は25～30m四方に相当します
    **参考**：https://say-no.hatenadiary.org/entry/20110626/1309106165
* 座標数値を秒の単位の整数値とすると上記の幅を含むことになります

***
#### **重要**：測地系について
* 2002年の測量法改正に伴い、日本における測量・位置計測はITRF座標系GRS80楕円体　　に準拠すると規定されました。通称「世界測地系」と呼ばれ、GNSS(GPS)測位などで　　用いられるWGS84座標系とほぼ一致します
* これにより2002年以降の埋蔵文化財調査等における基準点測量も世界測地系に移行しています。しかしながら2002年以降の成果・刊行物にも、以前の座標系（日本測地系）を採用しているものが散見されます。2002年以前については日本測地系のものがほとんどです
* 測地系が明記されていない場合、報告書等に記載の緯度経度情報では正しい位置にプロットすることができない場合があります
* 日本測地系と世界測地系のずれは場所により異なりますが数秒～十数秒になりますので、実距離では200～300m程度のずれが生じることになります
    * 参考：https://www.drm.jp/jisx0410/JisGridSystem_1_Geoid.html
* 測地系が不確かな場合は、座標ではなく地図上の位置等を参考に修正する必要があります

***
#### 注意事項3：各種地図データの利用
* ひなたGIS、地理院地図で利用可能な地図画像にはそれぞれ利用条件が付されています
* 利用（刊行・ウェブ公開）にあたっては利用条件を十分に確認し著作権の侵害等が内容に配慮しましょう　

***
#### 実習の内容・データについて
* 本実習は、東京学芸大学2020年度春学期「地域考古学B」の一環として実施したものの一部です
* 資料・内容はCC-BYで公開します。複製、再利用、転載、改変は可能ですが、かならず出典を表記してください
* 使用データには上記東京学芸大講義において、受講生が協力して作成したものを含みます。複製、再利用、転載、改変は可能ですが、かならず出典を表記してください
> 表記例: 野口　淳(2020) 考古学・文化財のためのデータサイエンス・サロンonline #01「オープンリソースによる遺跡地図作成実習 part1」(https://github.com/kotdijian/JASOSR/tree/master/MappingWorkshop)  

